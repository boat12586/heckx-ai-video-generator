{% extends "base.html" %}

{% block title %}Heckx AI Assistant - Desktop{% endblock %}

{% block content %}
<div class="chat-container">
    <div class="chat-messages" id="chatMessages">
        <div class="message system">
            <div class="message-header">ü§ñ ‡∏£‡∏∞‡∏ö‡∏ö</div>
            <div class="message-content">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ Heckx ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡∏ü‡∏µ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏• 
‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Wikipedia ‡πÅ‡∏•‡∏∞‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ
‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?</div>
        </div>
    </div>
    
    <div class="status-indicator" id="statusIndicator">üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
    
    <div class="input-area">
        <div class="input-group">
            <input type="text" class="input-field" id="messageInput" 
                   placeholder="üí¨ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." 
                   autocomplete="off">
            <button class="send-button" id="sendButton">üì§ ‡∏™‡πà‡∏á</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
const socket = io();
const chatMessages = document.getElementById('chatMessages');
const messageInput = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');
const statusIndicator = document.getElementById('statusIndicator');

let isThinking = false;

// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket
socket.on('connect', function() {
    console.log('Connected to server');
    statusIndicator.textContent = 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
});

socket.on('disconnect', function() {
    statusIndicator.textContent = 'üî¥ ‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
});

// ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
socket.on('thinking', function(data) {
    isThinking = data.status;
    if (isThinking) {
        statusIndicator.innerHTML = 'üß† <span class="thinking">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î</span>';
        sendButton.disabled = true;
    } else {
        statusIndicator.textContent = 'üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        sendButton.disabled = false;
    }
});

socket.on('searching', function(data) {
    if (data.status) {
        statusIndicator.textContent = 'üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...';
    }
});

// ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
socket.on('response', function(data) {
    addMessage('heckx', data.response, data.timestamp);
    messageInput.focus();
});

// ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
socket.on('error', function(data) {
    addMessage('system', '‚ùå ' + data.message);
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function addMessage(sender, content, timestamp = null) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    const time = timestamp ? 
        new Date(timestamp).toLocaleTimeString('th-TH') : 
        new Date().toLocaleTimeString('th-TH');
    
    let icon, senderName;
    switch(sender) {
        case 'user':
            icon = 'üë§';
            senderName = '‡∏Ñ‡∏∏‡∏ì';
            break;
        case 'heckx':
            icon = 'ü§ñ';
            senderName = 'Heckx';
            break;
        default:
            icon = '‚ö†Ô∏è';
            senderName = '‡∏£‡∏∞‡∏ö‡∏ö';
    }
    
    messageDiv.innerHTML = `
        <div class="message-header">${icon} ${senderName} <span style="color: #888; font-size: 0.8em;">[${time}]</span></div>
        <div class="message-content">${content}</div>
    `;
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function sendMessage() {
    const message = messageInput.value.trim();
    if (!message || isThinking) return;
    
    addMessage('user', message);
    socket.emit('send_message', {message: message});
    messageInput.value = '';
}

// Event listeners
sendButton.addEventListener('click', sendMessage);

messageInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

// Auto-focus
messageInput.focus();
{% endblock %}