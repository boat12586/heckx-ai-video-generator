{% extends "base.html" %}

{% block title %}Heckx AI Assistant - Mobile{% endblock %}

{% block styles %}
<style>
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° styles ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    .mobile-optimized {
        touch-action: manipulation;
    }
    
    .input-field {
        font-size: 16px !important; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô zoom ‡πÉ‡∏ô iOS */
    }
    
    .chat-messages {
        height: calc(100vh - 250px) !important;
    }
    
    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å */
    @media (max-height: 600px) {
        .chat-messages {
            height: calc(100vh - 200px) !important;
        }
        
        .header {
            margin-bottom: 15px !important;
            padding: 15px !important;
        }
        
        .hologram-icon {
            width: 50px !important;
            height: 50px !important;
            font-size: 1.5em !important;
        }
        
        h1 {
            font-size: 1.3em !important;
        }
        
        .subtitle {
            font-size: 0.9em !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="chat-container mobile-optimized">
    <div class="chat-messages" id="chatMessages">
        <div class="message system">
            <div class="message-header">ü§ñ ‡∏£‡∏∞‡∏ö‡∏ö</div>
            <div class="message-content">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! Heckx AI Assistant ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö üì±‚ú®</div>
        </div>
    </div>
    
    <div class="status-indicator" id="statusIndicator">üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
    
    <div class="input-area">
        <div class="input-group">
            <input type="text" class="input-field" id="messageInput" 
                   placeholder="üí¨ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..." 
                   autocomplete="off">
            <button class="send-button" id="sendButton">üì§</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
// ‡πÉ‡∏ä‡πâ script ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö desktop ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
const socket = io();
const chatMessages = document.getElementById('chatMessages');
const messageInput = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');
const statusIndicator = document.getElementById('statusIndicator');

let isThinking = false;

// ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô zoom ‡πÉ‡∏ô iOS
messageInput.addEventListener('touchstart', function() {
    messageInput.style.fontSize = '16px';
});

// ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô desktop script ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
socket.on('connect', function() {
    statusIndicator.textContent = 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
});

socket.on('thinking', function(data) {
    isThinking = data.status;
    if (isThinking) {
        statusIndicator.innerHTML = 'üß† ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...';
        sendButton.disabled = true;
    } else {
        statusIndicator.textContent = 'üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        sendButton.disabled = false;
    }
});

socket.on('response', function(data) {
    addMessage('heckx', data.response, data.timestamp);
});

socket.on('error', function(data) {
    addMessage('system', '‚ùå ' + data.message);
});

function addMessage(sender, content, timestamp = null) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    const time = timestamp ? 
        new Date(timestamp).toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'}) : 
        new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'});
    
    let icon, senderName;
    switch(sender) {
        case 'user':
            icon = 'üë§';
            senderName = '‡∏Ñ‡∏∏‡∏ì';
            break;
        case 'heckx':
            icon = 'ü§ñ';
            senderName = 'Heckx';
            break;
        default:
            icon = '‚ö†Ô∏è';
            senderName = '‡∏£‡∏∞‡∏ö‡∏ö';
    }
    
    messageDiv.innerHTML = `
        <div class="message-header">${icon} ${senderName} <span style="color: #888; font-size: 0.8em;">[${time}]</span></div>
        <div class="message-content">${content}</div>
    `;
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function sendMessage() {
    const message = messageInput.value.trim();
    if (!message || isThinking) return;
    
    addMessage('user', message);
    socket.emit('send_message', {message: message});
    messageInput.value = '';
}

sendButton.addEventListener('click', sendMessage);

messageInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
    }
});

// Auto-scroll ‡πÅ‡∏•‡∏∞ focus optimization ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
window.addEventListener('resize', function() {
    chatMessages.scrollTop = chatMessages.scrollHeight;
});
{% endblock %}